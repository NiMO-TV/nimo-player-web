!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).NimoTV={})}(this,(function(e){"use strict";function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var u=10001,c=3001,f=3002,l=3003,h=3004;function p(){}function d(){d.init.call(this)}function v(e){return void 0===e._maxListeners?d.defaultMaxListeners:e._maxListeners}function y(e,t,n){if(t)e.call(n);else for(var r=e.length,i=O(e,r),o=0;o<r;++o)i[o].call(n)}function m(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,o=O(e,i),s=0;s<i;++s)o[s].call(n,r)}function g(e,t,n,r,i){if(t)e.call(n,r,i);else for(var o=e.length,s=O(e,o),a=0;a<o;++a)s[a].call(n,r,i)}function w(e,t,n,r,i,o){if(t)e.call(n,r,i,o);else for(var s=e.length,a=O(e,s),u=0;u<s;++u)a[u].call(n,r,i,o)}function b(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,o=O(e,i),s=0;s<i;++s)o[s].apply(n,r)}function _(e,t,n,r){var i,o,s,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]):(o=e._events=new p,e._eventsCount=0),s){if("function"==typeof s?s=o[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),!s.warned&&(i=v(e))&&i>0&&s.length>i){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,a=u,"function"==typeof console.warn?console.warn(a):console.log(a)}}else s=o[t]=n,++e._eventsCount;return e}function L(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function E(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function O(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}p.prototype=Object.create(null),d.EventEmitter=d,d.usingDomains=!1,d.prototype.domain=void 0,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.init=function(){this.domain=null,d.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new p,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},d.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},d.prototype.getMaxListeners=function(){return v(this)},d.prototype.emit=function(e){var t,n,r,i,o,s,a,u="error"===e;if(s=this._events)u=u&&null==s.error;else if(!u)return!1;if(a=this.domain,u){if(t=arguments[1],!a){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=a,t.domainThrown=!1,a.emit("error",t),!1}if(!(n=s[e]))return!1;var f="function"==typeof n;switch(r=arguments.length){case 1:y(n,f,this);break;case 2:m(n,f,this,arguments[1]);break;case 3:g(n,f,this,arguments[1],arguments[2]);break;case 4:w(n,f,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];b(n,f,this,i)}return!0},d.prototype.addListener=function(e,t){return _(this,e,t,!1)},d.prototype.on=d.prototype.addListener,d.prototype.prependListener=function(e,t){return _(this,e,t,!0)},d.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,L(this,e,t)),this},d.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,L(this,e,t)),this},d.prototype.removeListener=function(e,t){var n,r,i,o,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new p:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length;o-- >0;)if(n[o]===t||n[o].listener&&n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new p,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,s||t)}return this},d.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new p,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new p:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),o=0;o<i.length;++o)"removeListener"!==(r=i[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new p,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},d.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},d.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):E.call(e,t)},d.prototype.listenerCount=E,d.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var A=function(){function e(t,n){var i,o,s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r(this,"_containerId",void 0),r(this,"_container$",void 0),r(this,"targetOrigin","https://www.nimo.tv"),r(this,"handleWndMessage",(function(e){var t=e.data,n=e.origin,r=t||{},i=r.messageId,o=r._uuid,a=r.data;if(o===s.containerId&&(n!==s.targetOrigin&&(s.targetOrigin=n),i===u)){var c=a||{},f=c.eventType,l=c.data;s.emit(f,l)}})),r(this,"play",(function(){s.sendBizMsg(c)})),r(this,"pause",(function(){s.sendBizMsg(f)})),r(this,"destroy",(function(){s.player$&&s.player$.parentNode&&s.player$.parentNode.removeChild(s.player$)})),r(this,"getState",(function(){return new Promise((function(t,n){s.handleGetState=function(n){t(n),s.off(e.STATE,s.handleGetState)},s.on(e.STATE,s.handleGetState),s.sendBizMsg(l)}))})),r(this,"muted",(function(e){s.sendBizMsg(h,{muted:e})})),i=this,o=new d,i.on=function(e,t){t&&o.on(e,t)},i.off=function(e,t){t&&o.removeListener(e,t)},i.once=function(e,t){t&&o.once(e,t)},i.emit=function(){o.emit.apply(o,arguments)},i.trigger=i.emit,this.containerId=t,this.container$=document.getElementById(this.containerId),this.player$=this._createPlayer(n),this.container$.appendChild(this.player$),this.init()}return n(e,[{key:"containerId",set:function(e){this._containerId=e},get:function(){if(this._containerId)return this._containerId;throw new ReferenceError("this._containerId is not defined.")}},{key:"container$",set:function(e){this._container$=e},get:function(){if(this._container$)return this._container$;throw new ReferenceError("this._container$ is not defined.")}}]),n(e,[{key:"init",value:function(){window.addEventListener("message",this.handleWndMessage)}},{key:"dispose",value:function(){window.removeEventListener("message",this.handleWndMessage),this.handleGetState&&this.off(e.STATE,this.handleGetState),this.player$=null,this.container$=null,this.containerId=null}},{key:"sendBizMsg",value:function(e,t){this._send("biz_msg",{messageId:e,data:t})}},{key:"_send",value:function(e,t){var n=this.player$.contentWindow;n&&"function"==typeof n.postMessage&&n.postMessage(o({},t,{type:e,_uuid:this.containerId}),this.targetOrigin)}},{key:"_createPlayer",value:function(e){var t=e||{},n=t.width,r=t.height,i=t.resourceId,o=t.lang,s=t.autoplay,a=t.muted,u=document.createElement("iframe");return u.setAttribute("src",this._getUrl(i,{_lang:o,_autoplay:s,_muted:a})),u.setAttribute("width",n),u.setAttribute("height",r),u.setAttribute("frameborder",0),u.setAttribute("scrolling",0),u.setAttribute("allow","fullscreen"),u.setAttribute("allowfullscreen",!0),u}},{key:"_getUrl",value:function(e,t){var n="".concat(this.targetOrigin,"/embed/").concat(e);return n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t||t==={})return e;var n=e.split("?"),r=Object.keys(t),i=new RegExp("(".concat(r.join("|"),")=(\\w|.)+")),o=void 0!==n[1]?n[1].split("&").filter((function(e){return!i.test(e)})):[],a=[].concat(s(o),s(r.filter((function(e){return void 0!==t[e]})).map((function(e){return"".concat(e,"=").concat(t[e])}))));return"".concat(n[0]).concat(Array.isArray(a)&&a.length>0?"?".concat(a.join("&")):"")}(n,o({},t,{_uuid:this.containerId}))}}]),e}();r(A,"ENDED","ended"),r(A,"STATE","getPlayerState"),r(A,"PLAY","playing"),r(A,"PAUSED","paused"),r(A,"MUTED","muted"),e.Player=A,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=embed-player-0.6.0.min.js.map
